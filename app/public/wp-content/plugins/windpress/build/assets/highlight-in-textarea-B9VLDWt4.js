var g=new Map;function z(t){var e=g.get(t);e&&e.destroy()}function T(t){var e=g.get(t);e&&e.update()}var p=null;typeof window>"u"?((p=function(t){return t}).destroy=function(t){return t},p.update=function(t){return t}):((p=function(t,e){return t&&Array.prototype.forEach.call(t.length?t:[t],function(i){return function(n){if(n&&n.nodeName&&n.nodeName==="TEXTAREA"&&!g.has(n)){var o,r=null,s=window.getComputedStyle(n),l=(o=n.value,function(){v({testForHeightReduction:o===""||!n.value.startsWith(o),restoreTextAlign:null}),o=n.value}),y=(function(d){n.removeEventListener("autosize:destroy",y),n.removeEventListener("autosize:update",h),n.removeEventListener("input",l),window.removeEventListener("resize",h),Object.keys(d).forEach(function(c){return n.style[c]=d[c]}),g.delete(n)}).bind(n,{height:n.style.height,resize:n.style.resize,textAlign:n.style.textAlign,overflowY:n.style.overflowY,overflowX:n.style.overflowX,wordWrap:n.style.wordWrap});n.addEventListener("autosize:destroy",y),n.addEventListener("autosize:update",h),n.addEventListener("input",l),window.addEventListener("resize",h),n.style.overflowX="hidden",n.style.wordWrap="break-word",g.set(n,{destroy:y,update:h}),h()}function v(d){var c,u,E=d.restoreTextAlign,m=E===void 0?null:E,b=d.testForHeightReduction,L=b===void 0||b,A=s.overflowY;if(n.scrollHeight!==0&&(s.resize==="vertical"?n.style.resize="none":s.resize==="both"&&(n.style.resize="horizontal"),L&&(c=function(a){for(var k=[];a&&a.parentNode&&a.parentNode instanceof Element;)a.parentNode.scrollTop&&k.push([a.parentNode,a.parentNode.scrollTop]),a=a.parentNode;return function(){return k.forEach(function(R){var x=R[0],N=R[1];x.style.scrollBehavior="auto",x.scrollTop=N,x.style.scrollBehavior=null})}}(n),n.style.height=""),u=s.boxSizing==="content-box"?n.scrollHeight-(parseFloat(s.paddingTop)+parseFloat(s.paddingBottom)):n.scrollHeight+parseFloat(s.borderTopWidth)+parseFloat(s.borderBottomWidth),s.maxHeight!=="none"&&u>parseFloat(s.maxHeight)?(s.overflowY==="hidden"&&(n.style.overflow="scroll"),u=parseFloat(s.maxHeight)):s.overflowY!=="hidden"&&(n.style.overflow="hidden"),n.style.height=u+"px",m&&(n.style.textAlign=m),c&&c(),r!==u&&(n.dispatchEvent(new Event("autosize:resized",{bubbles:!0})),r=u),A!==s.overflow&&!m)){var w=s.textAlign;s.overflow==="hidden"&&(n.style.textAlign=w==="start"?"end":"start"),v({restoreTextAlign:w,testForHeightReduction:!0})}}function h(){v({testForHeightReduction:!0,restoreTextAlign:null})}}(i)}),t}).destroy=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],z),t},p.update=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],T),t});var I=p;function f(t,e){this.init(t,e)}f.instance=function(t,e){return new f(t,e)},f.prototype={ID:"hit",init:function(t,e){typeof t=="string"?this.el=document.querySelector(t):this.el=t,this.getType(e)==="custom"?(this.highlight=e,this.generate()):console.error("valid config object not provided")},getType:function(t){let e=typeof t;if(t){if(Array.isArray(t))return t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"?"range":"array";if(e==="object"){if(t instanceof RegExp)return"regexp";if(t.hasOwnProperty("highlight"))return"custom"}else if(e==="function"||e==="string")return e}else return"falsey";return"other"},generate:function(){this.el.classList.add(this.ID+"-input",this.ID+"-content"),this.el.addEventListener("input",this.handleInput.bind(this)),this.el.addEventListener("scroll",this.handleScroll.bind(this)),this.highlights=document.createElement("div"),this.highlights.classList.add(this.ID+"-highlights",this.ID+"-content"),this.backdrop=document.createElement("div"),this.backdrop.classList.add(this.ID+"-backdrop"),this.backdrop.append(this.highlights),this.container=document.createElement("div"),this.container.classList.add(this.ID+"-container"),this.el.parentNode.insertBefore(this.container,this.el.nextSibling),this.container.append(this.backdrop),this.container.append(this.el),this.container.addEventListener("scroll",this.blockContainerScroll.bind(this)),this.handleInput()},handleInput:function(){let t=this.el.value,e=this.getRanges(t,this.highlight),i=this.removeStaggeredRanges(e),n=this.getBoundaries(i);this.renderMarks(n)},getRanges:function(t,e){switch(this.getType(e)){case"array":return this.getArrayRanges(t,e);case"function":return this.getFunctionRanges(t,e);case"regexp":return this.getRegExpRanges(t,e);case"string":return this.getStringRanges(t,e);case"range":return this.getRangeRanges(t,e);case"custom":return this.getCustomRanges(t,e);default:if(e)console.error("unrecognized highlight type");else return[]}},getArrayRanges:function(t,e){let i=e.map(this.getRanges.bind(this,t));return Array.prototype.concat.apply([],i)},getFunctionRanges:function(t,e){return this.getRanges(t,e(t))},getRegExpRanges:function(t,e){let i=[],n;for(;n=e.exec(t),n!==null&&(i.push([n.index,n.index+n[0].length]),!!e.global););return i},getStringRanges:function(t,e){let i=[],n=t.toLowerCase(),o=e.toLowerCase(),r=0;for(;r=n.indexOf(o,r),r!==-1;)i.push([r,r+o.length]),r+=o.length;return i},getRangeRanges:function(t,e){return[e]},getCustomRanges:function(t,e){let i=this.getRanges(t,e.highlight);return e.className&&i.forEach(function(n){n.className?n.className=e.className+" "+n.className:n.className=e.className}),e.blank&&i.forEach(function(n){n.blank=e.blank}),i},removeStaggeredRanges:function(t){let e=[];return t.forEach(function(i){e.some(function(n){let o=i[0]>n[0]&&i[0]<n[1],r=i[1]>n[0]&&i[1]<n[1];return o!==r})||e.push(i)}),e},getBoundaries:function(t){let e=[];return t.forEach(function(i){e.push({type:"start",index:i[0],className:i.className,blank:i.blank}),e.push({type:"stop",index:i[1]})}),this.sortBoundaries(e),e},sortBoundaries:function(t){t.sort(function(e,i){return e.index!==i.index?i.index-e.index:e.type==="stop"&&i.type==="start"?1:e.type==="start"&&i.type==="stop"?-1:0})},renderMarks:function(t){let e=this.el.value;const i=e;t.forEach(function(n,o){let r;n.type==="start"?r="{{hit-mark-start|"+o+"}}":r="{{hit-mark-stop}}",e=e.slice(0,n.index)+r+e.slice(n.index)}),e=e.replace(/\n({{hit-mark-stop}})?$/,`
$1`),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/{{hit-mark-start\|(\d+)}}/g,function(n,o){const r=t[+o].className;if(r){let s='<mark class="'+r+'"';if(r==="word"){let l=i.slice(t[+o].index,t[+o-1].index);l=l.replace(/"/g,"&quot;"),s+=' data-word="'+l+'"'}return s+">"}else return"<mark>"}),e=e.replace(/{{hit-mark-stop}}/g,"</mark>"),e+='<mark class="placeholder"> \u26A1 </mark>',this.highlights.innerHTML=e,this.el.dispatchEvent(new CustomEvent("highlights-updated"))},handleScroll:function(){this.backdrop.scrollTop=this.el.scrollTop;let t=this.el.scrollLeft;t>0?this.backdrop.style.transform="translateX("+-t+"px)":this.backdrop.style.transform=""},blockContainerScroll:function(){this.container.scrollLeft=0},destroy:function(){this.container.parentElement.replaceChild(this.el,this.container),this.el.classList.remove(this.ID+"-content",this.ID+"-input")}};export{f as H,I as n};
