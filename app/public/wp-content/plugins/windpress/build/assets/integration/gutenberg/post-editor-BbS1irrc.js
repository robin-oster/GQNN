import{l as e}from"../../logger-BTW-zIW3.js";e("Loading..."),(async()=>{let m,c,a;e("waiting for the editor-visual-editor...");let u=0;const y=300;for(;!m&&u<y;){if(m=document.querySelector("div.editor-visual-editor"),u++,u>=y){e("time out! failed to find editor-visual-editor");break}await new Promise(i=>setTimeout(i,100))}if(!m){e("editor-visual-editor not found, skipping the injection process...");return}if(!m.classList.contains("is-iframed")){e("editor-visual-editor is not iframed, starting the observer immediately..."),window.twPlayObserverStart&&window.twPlayObserverStart();return}for(e("waiting for the iframeEl...");!c;)c=document.querySelector('iframe[name="editor-canvas"]'),await new Promise(i=>setTimeout(i,100));e("finding WindPress script...");let f=!1,g=setTimeout(()=>{f=!0},45e3);for(;!f;){if(a=document.querySelectorAll("script"),a=Array.from(a).filter(i=>{let o=i.getAttribute("id");return o&&(o.startsWith("windpress:")||o.startsWith("vite-client"))&&!o.startsWith("windpress:integration-")}),a.length>0){clearTimeout(g);break}await new Promise(i=>setTimeout(i,100))}if(f){e("time out! failed to find WindPress script");return}e("found WindPress script");let v=c.contentWindow||c,p=c.contentDocument||v.document;for(;!p.head;)await new Promise(i=>setTimeout(i,300));e("injecting WindPress script into the root container");let b=p.querySelectorAll("script");Array.from(b).some(i=>{let o=i.getAttribute("id");return o&&o.startsWith("windpress:")})?e("WindPress script is already injected, skipping the injection process..."):(e("starting the root injection process..."),a.forEach(i=>{p.head.appendChild(document.createRange().createContextualFragment(i.outerHTML))}));let h=null;new MutationObserver(async i=>{let o=!1,n=[],s=2e3;for(const r of i){if(o)break;r.type==="childList"&&(r.removedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&t.matches("div.components-modal__screen-overlay")&&(h=null)}),r.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&t.matches("body > div.components-modal__screen-overlay")&&(h=t,o=!0)}))}if(o){for(e("waiting for the patternIframes...");n.length===0&&s>0;)n=h.querySelectorAll("div.block-editor-block-preview__container > div > div > div.block-editor-iframe__scale-container > iframe"),s-=100,await new Promise(r=>setTimeout(r,100));if(s<=0&&n.length===0){e("time out! failed to find the patternIframes");return}n.forEach(r=>{let t=(r.contentDocument||r.contentWindow.document).head;Array.from(t.querySelectorAll("script")).some(d=>{let l=d.getAttribute("id");return l&&l.startsWith("windpress:")})?e("WindPress script is already injected into the pattern iframe, skipping the injection process..."):(e("injecting WindPress script into the pattern iframe"),a.forEach(d=>{t.appendChild(document.createRange().createContextualFragment(d.outerHTML))}))}),n=[]}}).observe(document.body,{childList:!0,subtree:!1});let w=null;new MutationObserver(async i=>{let o=!1,n=[],s=2e4;for(const r of i){if(o)break;r.type==="childList"&&(r.removedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&t.matches("div.block-editor-inserter__category-panel")&&(w=null)}),r.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&t.matches("div.block-editor-inserter__category-panel")&&(w=t,o=!0)}))}if(o){for(e("waiting for the patternIframes...");n.length===0&&s>0;)n=w.querySelectorAll("div.block-editor-block-preview__container > div > div > div.block-editor-iframe__scale-container > iframe"),s-=100,await new Promise(r=>setTimeout(r,100));if(s<=0&&n.length===0){e("time out! failed to find the patternIframes");return}n.forEach(r=>{let t=(r.contentDocument||r.contentWindow.document).head;Array.from(t.querySelectorAll("script")).some(d=>{let l=d.getAttribute("id");return l&&l.startsWith("windpress:")})?e("WindPress script is already injected into the pattern iframe, skipping the injection process..."):(e("injecting WindPress script into the pattern iframe"),a.forEach(d=>{t.appendChild(document.createRange().createContextualFragment(d.outerHTML))}))}),n=[]}}).observe(document.body,{childList:!0,subtree:!0})})();
