import{settingsState as w,brxGlobalProp as g}from"./constant-ClLhar2j.js";import{l as d}from"./logger-BTW-zIW3.js";import{c as I}from"./index.browser-B0na17u1.min.js";import{b as y,c as K,d as R,g as G,i as U,a as B,e as J,f as X,h as M,j as Q,S as Y}from"./_initCloneObject-DlLbeobz.min.js";import{d as _,b as C,a as Z,i as tt}from"./set-Dt5k9sTt.min.js";import{e as j,i as P,a as et}from"./_toKey-BxB36GnB.min.js";import{a as b,b as O,c as rt}from"./isObject-K1YoVIH1.min.js";import{w as nt}from"./runtime-core.esm-bundler-HqF9pg4M.min.js";import"./virtualRef-CgRKHaPH.js";import"./index-l5GBeiGs.min.js";import"./get-DBhW7rda.min.js";function H(t){return t}function at(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)}function it(t,r){var e=-1,n=t.length;for(r||(r=Array(n));++e<n;)r[e]=t[e];return r}var ot=800,st=16,lt=Date.now;function ct(t){var r=0,e=0;return function(){var n=lt(),i=st-(n-e);if(e=n,i>0){if(++r>=ot)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}function ut(t){return function(){return t}}var dt=_?function(t,r){return _(t,"toString",{configurable:!0,enumerable:!1,value:ut(r),writable:!0})}:H,mt=ct(dt);function pt(t,r,e,n){var i=!e;e||(e={});for(var a=-1,o=r.length;++a<o;){var s=r[a],l=void 0;l===void 0&&(l=t[s]),i?C(e,s,l):Z(e,s,l)}return e}var S=Math.max;function ft(t,r,e){return r=S(r===void 0?t.length-1:r,0),function(){for(var n=arguments,i=-1,a=S(n.length-r,0),o=Array(a);++i<a;)o[i]=n[r+i];i=-1;for(var s=Array(r+1);++i<r;)s[i]=n[i];return s[r]=e(o),at(t,this,s)}}function gt(t,r){return mt(ft(t,r,H),t+"")}function bt(t,r,e){if(!b(e))return!1;var n=typeof r;return(n=="number"?y(e)&&tt(r,e.length):n=="string"&&r in e)?j(e[r],t):!1}function vt(t){return gt(function(r,e){var n=-1,i=e.length,a=i>1?e[i-1]:void 0,o=i>2?e[2]:void 0;for(a=t.length>3&&typeof a=="function"?(i--,a):void 0,o&&bt(e[0],e[1],o)&&(a=i<3?void 0:a,i=1),r=Object(r);++n<i;){var s=e[n];s&&t(r,s,n,a)}return r})}function ht(t){var r=[];if(t!=null)for(var e in Object(t))r.push(e);return r}var wt=Object.prototype,yt=wt.hasOwnProperty;function kt(t){if(!b(t))return ht(t);var r=K(t),e=[];for(var n in t)n=="constructor"&&(r||!yt.call(t,n))||e.push(n);return e}function q(t){return y(t)?R(t,!0):kt(t)}var xt="[object Object]",Tt=Function.prototype,Lt=Object.prototype,D=Tt.toString,Nt=Lt.hasOwnProperty,Et=D.call(Object);function At(t){if(!O(t)||rt(t)!=xt)return!1;var r=G(t);if(r===null)return!0;var e=Nt.call(r,"constructor")&&r.constructor;return typeof e=="function"&&e instanceof e&&D.call(e)==Et}function Mt(t){return function(r,e,n){for(var i=-1,a=Object(r),o=n(r),s=o.length;s--;){var l=o[++i];if(e(a[l],l,a)===!1)break}return r}}var _t=Mt();function k(t,r,e){(e!==void 0&&!j(t[r],e)||e===void 0&&!(r in t))&&C(t,r,e)}function Ct(t){return O(t)&&y(t)}function x(t,r){if(!(r==="constructor"&&typeof t[r]=="function")&&r!="__proto__")return t[r]}function jt(t){return pt(t,q(t))}function Pt(t,r,e,n,i,a,o){var s=x(t,e),l=x(r,e),E=o.get(l);if(E){k(t,e,E);return}var c=a?a(s,l,e+"",t,r,o):void 0,f=c===void 0;if(f){var v=P(l),h=!v&&U(l),A=!v&&!h&&B(l);c=l,v||h||A?P(s)?c=s:Ct(s)?c=it(s):h?(f=!1,c=J(l,!0)):A?(f=!1,c=X(l,!0)):c=[]:At(l)||M(l)?(c=s,M(s)?c=jt(s):(!b(s)||et(s))&&(c=Q(l))):f=!1}f&&(o.set(l,c),i(c,l,n,a,o),o.delete(l)),k(t,e,c)}function $(t,r,e,n,i){t!==r&&_t(r,function(a,o){if(i||(i=new Y),b(a))Pt(t,r,o,e,$,n,i);else{var s=n?n(x(t,o),a,o+"",t,r,i):void 0;s===void 0&&(s=a),k(t,o,s)}},q)}var u=vt(function(t,r,e){$(t,r,e)});const V=()=>I("1234567890abcdefghijklmnopqrstuvwxyz",6)();function T(){let t=V();for(;t.match(/^\d/);)t=V();return`windpress${t}`}function Ot(t){const r=[];return t.childNodes.forEach(e=>{const n=W(e);n.transformedNode&&r.push(n.transformedNode)}),z(r,0)}function Ht(t){const r=t.tagName.toLowerCase();let e={id:T(),name:"div",settings:{tag:r},children:[]};const n=[],i=["id","class","href","src"];if(Object.keys(t.attributes).forEach(a=>{const o=t.attributes[a].name;i.includes(o)?(o==="class"&&t.attributes[a].value.trim()!==""&&u(e.settings,{_cssClasses:t.attributes[a].value}),o==="id"&&t.id.trim()!==""&&u(e.settings,{_cssId:t.id}),o==="href"&&t.tagName.toLowerCase()==="a"&&u(e.settings,{link:{url:t.getAttribute("href")}})):n.push({id:T(),name:o,value:t.attributes[a].value})}),u(e.settings,{_attributes:n}),r==="svg")return e.name="svg",u(e.settings,{source:"code",code:t.outerHTML}),e.settings._attributes=[],e;if(r==="img"){let a=t.getAttribute("src");return e.name="image",u(e.settings,{image:{external:!0,url:a||"",full:a||"",filename:a.split("/").pop()||""},altText:t.getAttribute("alt")||""}),delete e.settings.tag,e}if(r.match(/h[1-6]/)&&(e.name="heading",u(e.settings,{text:t.innerText,tag:r})),r==="video"||r==="iframe"&&(t.getAttribute("src").includes("youtube.com")||t.getAttribute("src").includes("vimeo.com")))return e.name="video",u(e.settings,{source:"url",url:r==="video"?t.getAttribute("src"):t.getAttribute("src").split("?")[0]}),delete e.settings.tag,e;if(r==="a"){if(u(e.settings,{link:{type:"external",url:t.getAttribute("href")||"",newTab:t.getAttribute("target")==="_blank",ariaLabel:t.getAttribute("aria-label")||"",title:t.getAttribute("title")||"",rel:t.getAttribute("rel")||""}}),t.children.length===0)return e.name="text-basic",u(e.settings,{text:t.innerText}),e;u(e.settings,{text:t.innerText})}return t.childNodes.forEach(a=>{const{transformedNode:o,brxNode:s=null}=W(a,t,e);o&&e.children.push(o),s&&(e=s)}),e}function W(t,r=null,e=null){return t.nodeType===Node.ELEMENT_NODE?{transformedNode:Ht(t)}:t.nodeType===Node.TEXT_NODE&&t.nodeValue.trim()!==""?r&&e&&r.childNodes.length===1&&(r.tagName.toLowerCase()==="p"||r.tagName.toLowerCase()==="span"||r.tagName.toLowerCase()==="div")?(e.name="text-basic",u(e.settings,{text:t.nodeValue}),{transformedNode:null,brxNode:e}):{transformedNode:{id:T(),name:"text-basic",settings:{tag:"span",text:t.nodeValue},children:[]}}:{transformedNode:null}}function z(t,r){const e=[];return t.forEach(n=>{n.parent=r,n._children=n.children.map(i=>i.id),e.push(n),e.push(...z(n.children,n.id)),n.children=n._children,delete n._children}),e}async function St(){if(!navigator.permissions)return d("Clipboard permissions not supported",{module:"html2bricks",type:"error"}),!1;let t="";const r=await navigator.permissions.query({name:"clipboard-read",allowWithoutGesture:!1});if(r.state==="prompt"&&(d("Requesting clipboard-read permission",{module:"html2bricks"}),t=await navigator.clipboard.readText(),r.state!=="granted"))return d("Clipboard-read permission denied",{module:"html2bricks",type:"error"}),!1;t=await navigator.clipboard.readText();const e=await navigator.permissions.query({name:"clipboard-write"});return e.state==="prompt"&&(d("Requesting clipboard-write permission",{module:"html2bricks"}),await navigator.clipboard.writeText(t),e.state!=="granted")?(d("Clipboard-write permission denied",{module:"html2bricks",type:"error"}),!1):!0}async function L(){if(!await St()){g.$_showMessage("[WindPress] Clipboard access not available");return}const t=(await navigator.clipboard.readText()).trim();if(!t||t.charAt(0)!=="<"){d("Pasted content is not HTML",{module:"html2bricks",type:"error"}),g.$_showMessage("[WindPress] Pasted content is not HTML");return}const r=new DOMParser().parseFromString(t,"text/html").body,e={content:Ot(r),source:"bricksCopiedElements",sourceUrl:window.bricksData.siteUrl,version:window.bricksData.version,globalClasses:[],globalElements:[]};await navigator.clipboard.writeText(JSON.stringify(e,null)),g.$_pasteElements(),g.$_showMessage("[WindPress] HTML pasted"),await navigator.clipboard.writeText(t)}document.addEventListener("keydown",t=>{w("module.html2bricks.copy-paste",!0).value&&(t.target.id==="bricks-toolbar"||t.target.id==="bricks-panel"||!(t.ctrlKey||t.metaKey)||!t.shiftKey||t.key.toLowerCase()!=="v"||L())});const N=document.querySelector("#bricks-builder-context-menu li:nth-child(2)"),m=document.createElement("li");m.id="windpressbricks-html2bricks-context-menu",m.classList.add("sep"),m.innerHTML='<span class="label">Paste HTML</span><span class="shortcut">CTRL + SHIFT + V</span>',m.addEventListener("click",L);const qt=document.querySelector('#bricks-panel-header>ul.actions>li[data-balloon="Paste (All)"]'),p=document.createElement("li");p.dataset.balloon="Paste HTML",p.dataset.balloonPos="bottom-right",p.innerHTML=`
    <span class="bricks-svg-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-html5" fill="none" stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 4l-2 14.5l-6 2l-6 -2l-2 -14.5z" /><path d="M15.5 8h-7l.5 4h6l-.5 3.5l-2.5 .75l-2.5 -.75l-.1 -.5" /></svg>
    </span>
`,p.addEventListener("click",L);const F=()=>{N.classList.remove("sep"),N.insertAdjacentElement("afterend",m),qt.insertAdjacentElement("afterend",p)},Dt=()=>{N.classList.add("sep"),m.remove(),p.remove()};w("module.html2bricks.copy-paste",!0).value&&F(),nt(()=>w("module.html2bricks.copy-paste",!0).value,t=>{t?F():Dt()}),d("Module loaded!",{module:"html2bricks"});
