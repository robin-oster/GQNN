import{l as s}from"./logger-BTW-zIW3.js";import{e as a}from"./constant-Diz46mji.js";async function u(){let r=a(),i=[];s("finding WindPress script...",{module:"play/observer"});let o=!1,d=setTimeout(()=>{o=!0},45e3);for(;!o;){if(i=document.querySelectorAll("script"),i=Array.from(i).filter(e=>{let t=e.getAttribute("id");return t&&(t.startsWith("windpress:")||t.startsWith("vite-client"))&&!t.startsWith("windpress:integration-")}),i.length>0){clearTimeout(d);break}await new Promise(e=>setTimeout(e,100))}if(o){s("time out! failed to find WindPress script",{module:"play/observer"});return}s("found WindPress script",{module:"play/observer"});let l=r.contentWindow||r,n=r.contentDocument||l.document;for(;!n.head;)await new Promise(e=>setTimeout(e,300));s("injecting WindPress script into the root container",{module:"play/observer"});let c=n.querySelectorAll("script");Array.from(c).some(e=>{let t=e.getAttribute("id");return t&&t.startsWith("windpress:")})?s("WindPress script is already injected, skipping the injection process...",{module:"play/observer"}):(s("starting the root injection process...",{module:"play/observer"}),i.forEach(e=>{let t=e.getAttribute("id");t&&(t.startsWith("windpress:metadata")||t.startsWith("vite-client"))?n.head.appendChild(document.createRange().createContextualFragment(e.outerHTML)):n.body.appendChild(document.createRange().createContextualFragment(e.outerHTML))}),s("WindPress script injected successfully",{module:"play/observer"})),r.dataset.windpressInjected="true"}const m=new MutationObserver(()=>{const r=a();r&&!r.dataset.windpressInjected&&setTimeout(()=>{r.dataset.windpressInjected||u()},100)});m.observe(document,{subtree:!0,childList:!0}),s("Play: observer.ts module loaded");
