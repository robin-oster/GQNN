import{d as H,a as K}from"./worker-2mJa2xxM.js";import{ai as $,aj as S,m as U,n as I}from"./dashboard-DzHlilbd.js";import{u as Z}from"./index-l5GBeiGs.min.js";import{U as z,i as L,S as A,a as F}from"./_initCloneObject-DlLbeobz.min.js";import{M as J,e as Q,i as k}from"./_toKey-BxB36GnB.min.js";import{S as D,b as V}from"./isObject-K1YoVIH1.min.js";import{af as N,V as W,w as X,a6 as Y}from"./runtime-core.esm-bundler-HqF9pg4M.min.js";var ee="__lodash_hash_undefined__";function te(e){return this.__data__.set(e,ee),this}function re(e){return this.__data__.has(e)}function P(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new J;++t<r;)this.add(e[t])}P.prototype.add=P.prototype.push=te,P.prototype.has=re;function ne(e,t){for(var r=-1,s=e==null?0:e.length;++r<s;)if(t(e[r],r,e))return!0;return!1}function ae(e,t){return e.has(t)}var se=1,ie=2;function R(e,t,r,s,o,a){var u=r&se,v=e.length,f=t.length;if(v!=f&&!(u&&f>v))return!1;var h=a.get(e),g=a.get(t);if(h&&g)return h==t&&g==e;var m=-1,c=!0,y=r&ie?new P:void 0;for(a.set(e,t),a.set(t,e);++m<v;){var p=e[m],_=t[m];if(s)var b=u?s(_,p,m,t,e,a):s(p,_,m,e,t,a);if(b!==void 0){if(b)continue;c=!1;break}if(y){if(!ne(t,function(j,n){if(!ae(y,n)&&(p===j||o(p,j,r,s,a)))return y.push(n)})){c=!1;break}}else if(!(p===_||o(p,_,r,s,a))){c=!1;break}}return a.delete(e),a.delete(t),c}function oe(e){var t=-1,r=Array(e.size);return e.forEach(function(s,o){r[++t]=[o,s]}),r}function ue(e){var t=-1,r=Array(e.size);return e.forEach(function(s){r[++t]=s}),r}var ce=1,le=2,fe="[object Boolean]",de="[object Date]",ve="[object Error]",he="[object Map]",pe="[object Number]",me="[object RegExp]",_e="[object Set]",ge="[object String]",ye="[object Symbol]",be="[object ArrayBuffer]",we="[object DataView]",T=D?D.prototype:void 0,O=T?T.valueOf:void 0;function je(e,t,r,s,o,a,u){switch(r){case we:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case be:return!(e.byteLength!=t.byteLength||!a(new z(e),new z(t)));case fe:case de:case pe:return Q(+e,+t);case ve:return e.name==t.name&&e.message==t.message;case me:case ge:return e==t+"";case he:var v=oe;case _e:var f=s&ce;if(v||(v=ue),e.size!=t.size&&!f)return!1;var h=u.get(e);if(h)return h==t;s|=le,u.set(e,t);var g=R(v(e),v(t),s,o,a,u);return u.delete(e),g;case ye:if(O)return O.call(e)==O.call(t)}return!1}var Ee=1,Pe=Object.prototype,xe=Pe.hasOwnProperty;function Ae(e,t,r,s,o,a){var u=r&Ee,v=$(e),f=v.length,h=$(t),g=h.length;if(f!=g&&!u)return!1;for(var m=f;m--;){var c=v[m];if(!(u?c in t:xe.call(t,c)))return!1}var y=a.get(e),p=a.get(t);if(y&&p)return y==t&&p==e;var _=!0;a.set(e,t),a.set(t,e);for(var b=u;++m<f;){c=v[m];var j=e[c],n=t[c];if(s)var i=u?s(n,j,c,t,e,a):s(j,n,c,e,t,a);if(!(i===void 0?j===n||o(j,n,r,s,a):i)){_=!1;break}b||(b=c=="constructor")}if(_&&!b){var l=e.constructor,d=t.constructor;l!=d&&"constructor"in e&&"constructor"in t&&!(typeof l=="function"&&l instanceof l&&typeof d=="function"&&d instanceof d)&&(_=!1)}return a.delete(e),a.delete(t),_}var Oe=1,q="[object Arguments]",B="[object Array]",x="[object Object]",$e=Object.prototype,C=$e.hasOwnProperty;function Se(e,t,r,s,o,a){var u=k(e),v=k(t),f=u?B:S(e),h=v?B:S(t);f=f==q?x:f,h=h==q?x:h;var g=f==x,m=h==x,c=f==h;if(c&&L(e)){if(!L(t))return!1;u=!0,g=!1}if(c&&!g)return a||(a=new A),u||F(e)?R(e,t,r,s,o,a):je(e,t,f,r,s,o,a);if(!(r&Oe)){var y=g&&C.call(e,"__wrapped__"),p=m&&C.call(t,"__wrapped__");if(y||p){var _=y?e.value():e,b=p?t.value():t;return a||(a=new A),o(_,b,r,s,a)}}return c?(a||(a=new A),Ae(e,t,r,s,o,a)):!1}function M(e,t,r,s,o){return e===t?!0:e==null||t==null||!V(e)&&!V(t)?e!==e&&t!==t:Se(e,t,r,s,M,o)}function G(e,t){return M(e,t)}const Ie=H("volume",()=>{const e=K(),t=U(),r=N({entries:[]}),s=N({entries:[]}),o=W(null),a=Z("windpress.dashboard.store.volume.activeViewEntryRelativePath",null);function u(n){return n=n.replace(/[^a-zA-Z0-9._/-]+/g,""),n=n.replace(/\.{2,}/g,"."),n=n.replace(/\/{2,}/g,"/"),n=n.replace(/^[._/ -]+|[._/ -]+$/g,""),n}function v(n){let i=n.split("/").map(u).join("/");i=u(i);const l=r.entries.findIndex(d=>d.relative_path===i);if(l!==-1){if(r.entries[l].hidden===!1)throw new Error(wp.i18n.__(`A file named "${i}" already exists`,"windpress"));r.entries[l].hidden=!1,r.entries[l].content=`/* file: ${i} */

`}else r.entries.push({name:i.split("/").pop()||"",content:`/* file: ${i} */

`,relative_path:`${i}`,handler:"internal"});o.value=`${i}`}function f(n){const i=r.entries.findIndex(l=>l.relative_path===n.relative_path);r.entries[i].content="",r.entries[i].hidden=!0,o.value===n.relative_path&&(o.value=null)}function h(n,i){const l=r.entries.findIndex(w=>w.relative_path===n.relative_path);let d=i.split("/").map(u).join("/");d=u(d);const E=r.entries.findIndex(w=>w.relative_path===d);if(E!==-1){if(r.entries[E].hidden===!1)throw new Error(wp.i18n.__(`A file named "${d}" already exists`,"windpress"));r.entries[E].hidden=!1,r.entries[E].content=r.entries[l].content,r.entries[E].signature&&delete r.entries[E].signature}else{const w=I(r.entries[l]);w.relative_path=d,w.name=d.split("/").pop()||"",w.content=r.entries[l].content,w.hidden=!1,w.signature=void 0,r.entries.push(w)}f(n)}function g(n){const i=r.entries.findIndex(l=>l.relative_path===n.relative_path);r.entries[i].content=""}function m(){return r.entries.reduce((n,i)=>(n[`/${i.relative_path}`]=i.content,n),{})}async function c(){return t.add("volume.doPull"),await e.request("/admin/volume/index",{method:"GET"}).then(n=>n.data).then(n=>{const i=n.entries;r.entries=i,p()}).catch(n=>{}).finally(()=>{t.remove("volume.doPull")})}async function y(){return t.add("volume.doPush"),e.request("/admin/volume/store",{method:"POST",data:{volume:{entries:r.entries}}}).then(n=>(p(),{message:n.data.message,success:!0})).catch(n=>{throw new Error(n.response?n.response.data.message:n.message)}).finally(()=>{t.remove("volume.doPush")})}X(o,n=>{a.value=n});function p(){if(r.entries.length===0)return;const n=r.entries.some(i=>i.relative_path===a.value);o.value=n?a.value:"main.css",_.value&&(s.entries=I(r.entries))}const _=Y(()=>!G(r.entries,s.entries));function b(n){const i=r.entries.find(d=>d.relative_path===n),l=s.entries.find(d=>d.relative_path===n);return!G(i,l)}async function j(){return r.entries.length===0?c():Promise.resolve()}return{data:r,initData:s,activeViewEntryRelativePath:o,hasChanged:_,addNewEntry:v,getKVEntries:m,doPull:c,doPush:y,entryHasChanged:b,softDeleteEntry:f,resetEntry:g,renameEntry:h,cleanPath:u,initPull:j}});export{Ie as u};
